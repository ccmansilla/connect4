<html>
<!-- estructura del juego connect4 html -->
<head>
<meta charset="utf-8" /> 
<title>Connect4</title>
<style>
/* vista del juego connect4 css */
#tablero{
	display: table;
	background-color: silver;
	border-collapse: collapse;
}
#tablero div{
	display: table-row;
}
#tablero div div{
	display: table-cell;
	width:  60px;
	height: 60px;
	border: 2px black solid;
}
div#jugador{
	width: 100px;
	margin-bottom: 10px;
	padding: 10px;
	font-weight: bold;
	border: 2px black solid;
	color: white;
}
</style>
<script>
/* logica del juego connect4 javascript */
var mini4 = {
	filas    : 6,
	columnas : 7,
	tablero  : [],  // tablero de juego contiene las fichas: 0=vacio, 1=ficha1, 2=ficha2
	ganador  : 0,   // 0=no hay, 1=jugador azul, 2=jugador rojo
	jugador  : 1,   // jugador que tiene el turno de jugar: 1=jugador azul, 2=jugador rojo
  
	//crea el tablero vacio
	inicio : function(){
		this.ganador = 0;
		this.tablero = new Array(this.filas-1); //arreglo de 0-5
		for(var i=0; i<this.filas; i++){
			this.tablero[i] = new Array(this.columnas-1); //arreglo de 0-6
			for(var j=0; j<this.columnas; j++){
				this.tablero[i][j] = 0; //contenido: 0=vacio
			}
		}
		
		//dibuja el tablero invertido
		var div = document.getElementById('tablero');
		var html = "";
		var id = 0;	
		for(var i = this.filas-1; i>=0; i--){
			html += "<div>";
			for(var j = this.columnas-1; j>=0; j--){
				var contenido = this.tablero[i][j];
				id = i *10 +j;
				html+= "<div onclick = 'mini4.ponerFicha("+j+")' id = '"+id+"'></div>";
			}
			html+= "</div>"
		}
		div.innerHTML = html;
                

		//dibuja color jugador
		var div = document.getElementById('jugador');
		div.style.backgroundColor = "blue";
		this.jugador = 1;
	},

	ponerFicha : function(columna){
		for(var i=0; i<this.filas; i++){
			if ((this.tablero[i][columna])=== 0){
			    this.tablero[i][columna]= this.jugador;
			    id = i * 10 + columna;
                            var div = document.getElementById(id);
			    if(this.jugador == 1){
			    	div.style.backgroundColor = 'blue';//ficha azul
			    }
			    else{
			    	div.style.backgroundColor = 'red';//ficha roja
                            }	 			
			    break;	
			}
		}
		this.hayGanador();
		if(this.ganador == 0){		
	        	this.cambiarJugador();
		}
		else if(this.ganador == 1){			
			if(confirm('Ganador Jugador Azul\n¿Desea jugar otra partida?')){
				this.inicio();
			}
		}
		else if(this.ganador == 2){
			if(confirm('Ganador Jugador Rojo\n¿Desea jugar otra partida?')){
				this.inicio();
			}
		}
			
	},

	cambiarJugador: function(){
        	var div = document.getElementById('jugador');
		var color = "";
		if(this.jugador == 1){
			this.jugador = 2;
			color="red";
		}
		else{
			this.jugador = 1;
			color="blue";
		}
		div.style.backgroundColor = color;
	},

	hayGanador: function(){ //busca 4 fichas consecutivas en horizontal y vertical
		var p1  = 0;
		var p2  = 0;
		this.ganador = 0;
		
		//recorrido horizontal
		for(var i=0; i<this.filas && this.ganador == 0; i++){
			for(var j=0; j<this.columnas; j++){
				if(this.tablero[i][j]==1){
					p1++;
					if(p1==4){ //cuatro fichas azules consecutivas horizontales
						this.ganador = 1;
						break;
					}
				}
				else{
					p1=0;
				}
				if(this.tablero[i][j]==2){
					p2++;
					if(p2==4){ //cuatro fichas rojas consecutivas horizontales
						this.ganador = 2;
						break;
					}
				}
				else{
					p2=0;
				}   
			}
		}
		
		p1  = 0;
		p2  = 0;
		//recorrido vertical
		for(var j=0; j<this.columnas && this.ganador == 0; j++){
			for(var i=0; i<this.filas; i++){
				if(this.tablero[i][j]==1){
					p1++;
					if(p1==4){ //cuatro fichas azules consecutivas verticales
						this.ganador = 1;
						break;
					}
				}
				else{
					p1=0;
				}
				if(this.tablero[i][j]==2){
					p2++;
					if(p2==4){ //cuatro fichas rojas consecutivas verticales
						this.ganador = 2;
						break;
					}
				}
				else{
					p2=0;
				}  
			}
		}		
		//son 6 diagonales a la derecha
		var d1 = [this.tablero[2][0],this.tablero[3][1],this.tablero[4][2],this.tablero[5][3]];
		var d2 = [this.tablero[1][0],this.tablero[2][1],this.tablero[3][2],this.tablero[4][3],this.tablero[5][4]];
		var d3 = [this.tablero[0][0],this.tablero[1][1],this.tablero[2][2],this.tablero[3][3],this.tablero[4][4],this.tablero[5][5]];
		var d4 = [this.tablero[0][1],this.tablero[1][2],this.tablero[2][3],this.tablero[3][4],this.tablero[4][5],this.tablero[5][6]];
		var d5 = [this.tablero[0][2],this.tablero[1][3],this.tablero[2][4],this.tablero[3][5],this.tablero[4][6]];
		var d6 = [this.tablero[0][3],this.tablero[1][4],this.tablero[2][5],this.tablero[3][6]];
		//son 6 diagonales a la izquierda
		var i1 = [this.tablero[0][3],this.tablero[1][2],this.tablero[2][1],this.tablero[3][0]];
		var i2 = [this.tablero[0][4],this.tablero[1][3],this.tablero[2][2],this.tablero[3][1],this.tablero[2][0]];
		var i3 = [this.tablero[0][5],this.tablero[1][4],this.tablero[2][3],this.tablero[3][2],this.tablero[4][1],this.tablero[5][0]];
		var i4 = [this.tablero[0][6],this.tablero[1][5],this.tablero[2][4],this.tablero[3][3],this.tablero[4][2],this.tablero[5][1]];
		var i5 = [this.tablero[1][6],this.tablero[2][5],this.tablero[3][4],this.tablero[4][3],this.tablero[5][4]];
		var i6 = [this.tablero[2][6],this.tablero[3][5],this.tablero[4][4],this.tablero[5][3]];
        
		if(this.ganador==0){ this.buscarGanadorDiagonal(d1) };
		if(this.ganador==0){ this.buscarGanadorDiagonal(d2) };
		if(this.ganador==0){ this.buscarGanadorDiagonal(d3) };
		if(this.ganador==0){ this.buscarGanadorDiagonal(d4) };
		if(this.ganador==0){ this.buscarGanadorDiagonal(d5) };
		if(this.ganador==0){ this.buscarGanadorDiagonal(d6) };
		
		if(this.ganador==0){ this.buscarGanadorDiagonal(i1) };
		if(this.ganador==0){ this.buscarGanadorDiagonal(i2) };
		if(this.ganador==0){ this.buscarGanadorDiagonal(i3) };
		if(this.ganador==0){ this.buscarGanadorDiagonal(i4) };
		if(this.ganador==0){ this.buscarGanadorDiagonal(i5) };
		if(this.ganador==0){ this.buscarGanadorDiagonal(i6) };
	},
	buscarGanadorDiagonal: function(d){
		var p1  = 0;
		var p2  = 0;
		var longitud = d.length;	
		for(var i= 0; i<=longitud; i++){
				if(d[i]==1){
					p1++;
					if(p1==4){ //cuatro fichas azules consecutivas diagonal
						this.ganador = 1;
						break;
					}
				}
				else{
					p1=0;
				}
				if(d[i]==2){
					p2++;
					if(p2==4){ //cuatro fichas rojas consecutivas diagonal
						this.ganador = 2;
						break;
					}
				}
				else{
					p2=0;
				}	
		}
	}
};
</script>
</head>
<body onload='mini4.inicio();'>
<h1>Connect4</h1>
<hr/>
<div id = 'jugador'>JUGADOR</div>
<div id = 'tablero'></div>
</body>
</html>
