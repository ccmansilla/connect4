<html>
<!-- estructura del juego connect4 html -->
<head>
<meta charset="utf-8" /> 
<title>Connect4</title>
<style>
/* vista del juego connect4 css */
.tablero{
	display: table;
	border-collapse: collapse;
}
.tablero div{
	display: table-row;
}
.tablero div div{
	display: table-cell;
	width: 40px;
	height: 40px;
	border: 1px black solid;
}
div.vacio{
	background-color: silver;	
}
div.ficha1{
	background-color: blue;		
}
div.ficha2{
	background-color: red;	
}
</style>
<script>
/* logica del juego connect4 javascript */
var mini4 = {
	filas    : 6,
	columnas : 7,
	tablero  : [],  // tablero de juego contiene las fichas: 0=vacio, 1=ficha1, 2=ficha2
	ganador  : 0,   // 0=nohay, 1=jugador1, 2=jugador2
	jugador  : 1,   // jugador que tiene el turno de jugar: 1=jugador1, 2=jugador2
  
	//crea el tablero vacio
	inicio : function(){
		this.tablero = new Array(this.filas-1); //arreglo de 0-5
		for(var i=0; i<this.filas; i++){
			this.tablero[i] = new Array(this.columnas-1); //arreglo de 0-6
			for(var j=0; j<this.columnas; j++){
				this.tablero[i][j] = 0; //contenido: 0=vacio, 1=ficha1, 2=ficha2
			}
		}
		this.dibujar();
		this.cambiarJugador();
	},

	dibujar : function(){
		var div = document.getElementById('tablero');
		var html = "";	
		for(var i = this.filas-1; i>=0; i--){
			html += "<div>";
			for(var j = this.columnas-1; j>=0; j--){
				var contenido = this.tablero[i][j];
				var ficha = "";
				switch(contenido){
					case 1:
						ficha="ficha1";
						break;
					case 2:
						ficha="ficha2";
						break;	
					default:
						ficha="vacio";
				}
				html+= "<div onclick = 'mini4.ponerFicha("+j+")' class='"+ficha+"' ></div>";
			}
			html+= "</div>"
		}
		div.innerHTML = html;
	},

	ponerFicha : function(columna){
		for(var i=0; i<this.filas; i++){
			if ((this.tablero[i][columna])=== 0){
			    this.tablero[i][columna]= this.jugador;
			    break;	
			}
		}
		this.hayGanador();
               	this.dibujar();	
		if(this.ganador == 0){		
	        	this.cambiarJugador();
		}
		else if(this.ganador == 1){
			alert('ganador jugador azul');
		}
		else{
			alert('ganador jugador rojo');
		}
			
	},

	cambiarJugador: function(){
        var div = document.getElementById('jugador');
		var ficha = "";
		if(this.jugador == 1){
			this.jugador = 2;
			ficha="ficha2";
		}
		else{
			this.jugador = 1;
			ficha="ficha1";
		}
        div.innerHTML = "JUGADOR: <div 	style='width: 42px;height: 42px;' class='"+ficha+"'></div><br>";
	},

	hayGanador: function(){ //busca 4 fichas consecutivas en horizontal y vertical
		var p1  = 0;
		var p2  = 0;
		this.ganador = 0;
		
		//recorrido horizontal
		for(var i=0; i<this.filas && this.ganador == 0; i++){
			for(var j=0; j<this.columnas; j++){
				if(this.tablero[i][j]==1){
					p1++;
					if(p1==4){ //cuatro fichas1 consecutivas horizontales
						this.ganador = 1;
						break;
					}
				}
				else{
					p1=0;
				}
				if(this.tablero[i][j]==2){
					p2++;
					if(p2==4){ //cuatro fichas2 consecutivas horizontales
						this.ganador = 2;
						break;
					}
				}
				else{
					p2=0
				}
			   
			}
		}
		
		p1  = 0;
		p2  = 0;
		//recorrido vertical
		for(var j=0; j<this.columnas && this.ganador == 0; j++){
			for(var i=0; i<this.filas; i++){
				if(this.tablero[i][j]==1){
					p1++;
					if(p1==4){ //cuatro fichas1 consecutivas verticales
						this.ganador = 1;
						break;
					}
				}
				else{
					p1=0;
				}
				if(this.tablero[i][j]==2){
					p2++;
					if(p2==4){ //cuatro fichas2 consecutivas verticales
						this.ganador = 2;
						break;
					}
				}
				else{
					p2=0
				}  
			}
		}		
		//son 6 diagonales a la derecha
		var dm2= [this.tablero[2][0],this.tablero[3][1],this.tablero[4][2],this.tablero[5][3]];
		var dm1= [this.tablero[1][0],this.tablero[2][1],this.tablero[3][2],this.tablero[4][3],this.tablero[5][4]];
		var d0 = [this.tablero[0][0],this.tablero[1][1],this.tablero[2][2],this.tablero[3][3],this.tablero[5][5]];
		var dn1= [this.tablero[0][1],this.tablero[1][2],this.tablero[2][3],this.tablero[3][4],this.tablero[4][5],this.tablero[5][6]];
		var dn2= [this.tablero[0][2],this.tablero[1][3],this.tablero[2][4],this.tablero[3][5],this.tablero[4][6]];
		var dn3= [this.tablero[0][3],this.tablero[1][4],this.tablero[2][5],this.tablero[3][6]];
		//son 6 diagonales a la izquierda
		var in3= [this.tablero[0][3],this.tablero[1][2],this.tablero[2][1],this.tablero[3][0]];
		var in4= [this.tablero[0][4],this.tablero[1][3],this.tablero[2][2],this.tablero[3][1],this.tablero[2][0]];
		var in5= [this.tablero[0][5],this.tablero[1][4],this.tablero[2][3],this.tablero[3][2],this.tablero[4][1],this.tablero[5][0]];
		var in6= [this.tablero[0][6],this.tablero[1][5],this.tablero[2][4],this.tablero[3][3],this.tablero[4][2],this.tablero[5][1]];
		var ir5= [this.tablero[1][6],this.tablero[2][5],this.tablero[3][4],this.tablero[4][3],this.tablero[5][4]];
		var ir4= [this.tablero[2][6],this.tablero[3][5],this.tablero[4][4],this.tablero[5][3]];
	}
};

function reset(){
	mini4.inicio();
}
</script>
</head>
<body onload='reset()'>
<h1>Connect4</h1>
<input type='button' onclick='reset()' value='reset'>
<hr/>
<div id = 'jugador'></div>
<div id = 'tablero' class='tablero'></div>
</body>
</html>
