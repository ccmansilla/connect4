<html>
<!-- estructura del juego connect4 html -->
<head>
<meta charset="utf-8" /> 
<title>Connect4</title>
<style>
/* vista del juego connect4 css */
#tablero{
	display: table;
	background-color: silver;
	border-collapse: collapse;
}
#tablero div{
	display: table-row;
}
#tablero div div{
	display: table-cell;
	width:  60px;
	height: 60px;
	border: 2px black solid;
}
div#jugador{
	width: 100px;
	margin-bottom: 10px;
	padding: 10px;
	font-weight: bold;
	border: 2px black solid;
	color: white;
}
</style>
<script>
/* logica del juego connect4 javascript */
var mini4 = {
	filas    : 6,
	columnas : 7,
	tablero  : [],  // tablero de juego contiene las fichas: 0=vacio, 1=ficha1, 2=ficha2
	ganador  : 0,   // 0=no hay, 1=jugador azul, 2=jugador rojo
	jugador  : 1,   // jugador que tiene el turno de jugar: 1=jugador azul, 2=jugador rojo
  
	//crea el tablero vacio y lo dibuja
	inicio : function(){
		this.ganador = 0;
		this.tablero = new Array(this.filas-1); //arreglo de 0-5
		
		//para dibujar el tablero invertido
		var div = document.getElementById('tablero');
		var html = "";
		var id = "";	
		for(var fila=0; fila<this.filas; fila++){
			html += "<div>";
			this.tablero[fila] = new Array(this.columnas-1); //arreglo de 0-6
			for(var columna=0; columna<this.columnas; columna++){
				this.tablero[fila][columna] = 0; //contenido: 0=vacio
				id = fila +"-"+columna;
				html+= "<div onclick = 'mini4.ponerFicha("+columna+")' id = '"+id+"'>"+id+"</div>";
			}
			html+= "</div>"
		}
		div.innerHTML = html;
                

		//dibuja color jugador
		var div = document.getElementById('jugador');
		div.style.backgroundColor = "blue";
		this.jugador = 1;
	},

	ponerFicha : function(columna){
		if(this.columnaCompleta(columna)){
			alert('Columna completa elija otra');
		}
		else{
			for(var fila=this.filas-1; fila>=0; fila--){
				if ((this.tablero[fila][columna])=== 0){
				    this.tablero[fila][columna]= this.jugador;
				    id = fila +"-"+columna;
		                    var div = document.getElementById(id);
				    if(this.jugador == 1){
				    	div.style.backgroundColor = 'blue';//pone ficha azul
				    }
				    else{
				    	div.style.backgroundColor = 'red';//pone ficha roja
		                    }	
				    this.hayGanador(fila,columna); 			
				    break;	
				}
			}
			if(this.ganador == 0){	
				if(this.hayEmpate()){	
					if(confirm('Empate\n¿Desea jugar otra partida?')){
						this.inicio();
					}
				}
				else{
					this.cambiarJugador();	
				}
			}
			else if(this.ganador == 1){			
				if(confirm('Ganador Jugador Azul\n¿Desea jugar otra partida?')){
					this.inicio();
				}
			}
			else if(this.ganador == 2){
				if(confirm('Ganador Jugador Rojo\n¿Desea jugar otra partida?')){
					this.inicio();
				}
			}
		}
			
	},

	columnaCompleta: function(columna){
		return (this.tablero[0][columna]!== 0);
	},

	hayEmpate: function(){
		var completo = true;
                var i = 0;
                while((i<=this.columnas-1)&&(completo)){
			if(!this.columnaCompleta(i)){	
                        	completo = false;
			}
		        i++;
		}
		return completo;
	},

	cambiarJugador: function(){
        	var div = document.getElementById('jugador');
		var color = "";
		if(this.jugador == 1){
			this.jugador = 2;
			color="red";
		}
		else{
			this.jugador = 1;
			color="blue";
		}
		div.style.backgroundColor = color;
	},

	hayGanador: function(fila,columna){ //busca 4 fichas consecutivas en horizontal y vertical
		var fichas1  = 0;
		var fichas2  = 0;
		this.ganador = 0;
		
		//chequeo horizontal
		for(var j=0; j<this.columnas; j++){
			if(this.tablero[fila][j]==1){
				fichas1++;
				if(fichas1==4){ //cuatro fichas azules consecutivas horizontales
					this.ganador = 1;
					break;
				}
			}
			else{
				fichas1=0;
			}
			if(this.tablero[fila][j]==2){
				fichas2++;
				if(fichas2==4){ //cuatro fichas rojas consecutivas horizontales
					this.ganador = 2;
					break;
				}
			}
			else{
				fichas2=0;
			}   
		}

		fichas1=0;
		fichas2=0;

		//chequeo vertical
		for(var i=0; i<this.filas; i++){
			if(this.tablero[i][columna]==1){
				fichas1++;
				if(fichas1==4){ //cuatro fichas azules consecutivas verticales
					this.ganador = 1;
					break;
				}
			}
			else{
				fichas1=0;
			}
			if(this.tablero[i][columna]==2){
				fichas2++;
				if(fichas2==4){ //cuatro fichas rojas consecutivas verticales
					this.ganador = 2;
					break;
				}
			}
			else{
				fichas2=0;
			}  
		}
		
		
	}
};
</script>
</head>
<body onload='mini4.inicio();'>
<h1>Connect4</h1>
<hr/>
<div id = 'jugador'>JUGADOR</div>
<div id = 'tablero'></div>
</body>
</html>
