<html>
<!-- estructura del juego connect4 html -->
<head>
<meta charset="utf-8" /> 
<title>Connect4</title>
<style>
/* vista del juego connect4 columnass */
#tablero{
	display: table;
	background-color: silver;
	border-collapse: collapse;
}
#tablero div{
	display: table-row;
}
#tablero div div{
	display: table-cell;
	width:  60px;
	height: 60px;
	border: 2px black solid;
}
div#jugador{
	width: 100px;
	margin-bottom: 10px;
	padding: 10px;
	font-weight: bold;
	border: 2px black solid;
	color: white;
}
</style>
<script>
/* logica del juego connect4 javascript */
var mini4 = {
	filas    : 6,
	columnas : 7,
	tablero  : [],  // tablero de juego contiene las fichas: 0=vacio, 1=ficha1, 2=ficha2
	ganador  : 0,   // 0=no hay, 1=jugador azul, 2=jugador rojo
	jugador  : 1,   // jugador que tiene el turno de jugar: 1=jugador azul, 2=jugador rojo
  
	//crea el tablero vacio y lo dibuja
	inicio : function(){
		this.ganador = 0;
		this.tablero = new Array(this.filas-1); //arreglo de 0-5
		
		//para dibujar el tablero invertido
		var div = document.getElementById('tablero');
		var html_tablero = "";
		var id = "";	
		for(var f=0; f<this.filas; f++){
			html_tablero += "<div>";
			this.tablero[f] = new Array(this.columnas-1); //arreglo de 0-6
			for(var c=0; c<this.columnas; c++){
				this.tablero[f][c] = 0; //contenido: 0=vacio
				id = f +"-"+c;
				html_tablero+= "<div onclick = 'mini4.ponerFicha("+c+")' id = '"+id+"'>"+id+"</div>";
			}
			html_tablero+= "</div>"
		}
		div.innerHTML = html_tablero;
                

		//dibuja color jugador
		var div = document.getElementById('jugador');
		div.style.backgroundColor = "blue";
		this.jugador = 1;
	},

	ponerFicha : function(c){
		if(this.columnaCompleta(c)){
			alert('Columna completa elija otra');
		}
		else{
			for(var f=this.filas-1; f>=0; f--){
				if ((this.tablero[f][c])=== 0){
				    this.tablero[f][c]= this.jugador;
				    id = f +"-"+c;
		                    var div = document.getElementById(id);
				    if(this.jugador == 1){
				    	div.style.backgroundColor = 'blue';//pone ficha azul
				    }
				    else{
				    	div.style.backgroundColor = 'red';//pone ficha roja
		                    }	
				    this.hayGanador(f,c); 			
				    break;	
				}
			}
			if(this.ganador == 0){	
				if(this.hayEmpate()){	
					if(confirm('Empate\n¿Desea jugar otra partida?')){
						this.inicio();
					}
				}
				else{
					this.cambiarJugador();	
				}
			}
			else if(this.ganador == 1){			
				if(confirm('Ganador Jugador Azul\n¿Desea jugar otra partida?')){
					this.inicio();
				}
			}
			else if(this.ganador == 2){
				if(confirm('Ganador Jugador Rojo\n¿Desea jugar otra partida?')){
					this.inicio();
				}
			}
		}	
	},

	columnaCompleta: function(c){
		return (this.tablero[0][c]!== 0);
	},

	hayEmpate: function(){
		var completo = true;
                var i = 0;
                while((i<=this.columnas-1)&&(completo)){
			if(!this.columnaCompleta(i)){	
                        	completo = false;
			}
		        i++;
		}
		return completo;
	},

	cambiarJugador: function(){
        	var div = document.getElementById('jugador');
		var color = "";
		if(this.jugador == 1){
			this.jugador = 2;
			color="red";
		}
		else{
			this.jugador = 1;
			color="blue";
		}
		div.style.backgroundColor = color;
	},

	hayGanador: function(f,c){ //busca 4 fichas consecutivas en horizontal y vertical

		var muestra = null;

		//chequeo horizontal
		if(this.ganador==0){
     		muestra=[this.tablero[f][0],this.tablero[f][1],this.tablero[f][2],this.tablero[f][3],this.tablero[f][4],this.tablero[f][5], this.tablero[f][6]];		
		this.contarFichas(muestra);
		}

		//chequeo vertical
		if(this.ganador==0){
		muestra=[this.tablero[0][c],this.tablero[1][c],this.tablero[2][c],this.tablero[3][c],this.tablero[4][c],this.tablero[5][c]];
			this.contarFichas(muestra);
		}
		
		//chequeo diagonal izquierda la selecciono con f+c
		if(this.ganador==0){
		switch (f+c) {
		    case 3:
		       muestra=[this.tablero[0][3],this.tablero[1][2],this.tablero[2][1],this.tablero[3][0]];
		       break;
		    case 4:
		       muestra=[this.tablero[0][4],this.tablero[1][3],this.tablero[2][2],this.tablero[3][1],this.tablero[2][0]];
		       break;
		    case 5:
		    muestra=[this.tablero[0][5],this.tablero[1][4],this.tablero[2][3],this.tablero[3][2],this.tablero[4][1],this.tablero[5][0]];
		       break;
		    case 6:
		    muestra=[this.tablero[0][6],this.tablero[1][5],this.tablero[2][4],this.tablero[3][3],this.tablero[4][2],this.tablero[5][1]];
		       break;
		    case 7:
		    muestra=[this.tablero[1][6],this.tablero[2][5],this.tablero[3][4],this.tablero[4][3],this.tablero[5][4]];
		       break;
		    case 8:
		    muestra=[this.tablero[2][6],this.tablero[3][5],this.tablero[4][4],this.tablero[5][3]];
		       break;
		    default:
		    muestra=null;
		} 
		if(muestra!==null){this.contarFichas(muestra);}
		}

		//chequeo diagonal derecha la selecciono f-c
		if(this.ganador==0){
		switch (f-c) {
		    case -3:
		       muestra=[this.tablero[0][3],this.tablero[1][4],this.tablero[2][5],this.tablero[3][6]];
		       break;
		    case -2:
		       muestra=[this.tablero[0][2],this.tablero[1][3],this.tablero[2][4],this.tablero[3][5],this.tablero[4][6]];
		       break;
		    case -1:
		    muestra=[this.tablero[0][1],this.tablero[1][2],this.tablero[2][3],this.tablero[3][4],this.tablero[4][5],this.tablero[5][6]];
		       break;
		    case 0:
		    muestra=[this.tablero[0][0],this.tablero[1][1],this.tablero[2][2],this.tablero[3][3],this.tablero[4][4],this.tablero[5][5]];
		       break;
		    case 1:
		    muestra=[this.tablero[1][0],this.tablero[2][1],this.tablero[3][2],this.tablero[4][3],this.tablero[5][4]];
		       break;
		    case 2:
		    muestra=[this.tablero[2][0],this.tablero[3][1],this.tablero[4][2],this.tablero[5][3]];
		       break;
		    default:
		    muestra=null;
		} 
		if(muestra!==null){this.contarFichas(muestra);} 
		}
	},

	contarFichas: function(muestra){
		var fichas1  = 0;
		var fichas2  = 0;
		var longitud = muestra.length;	
		for(var i= 0; i<=longitud; i++){
				if(muestra[i]==1){
					fichas1++;
					if(fichas1==4){ //cuatro fichas 1 (azules) consecutivas
						this.ganador = 1;
						break;
					}
				}
				else{
					fichas1=0;
				}
				if(muestra[i]==2){
					fichas2++;
					if(fichas2==4){ //cuatro fichas 2 (rojas) consecutivas
						this.ganador = 2;
						break;
					}
				}
				else{
					fichas2=0;
				}	
		}
	}
};
</script>
</head>
<body onload='mini4.inicio();'>
<h1>Connect4</h1>
<hr/>
<div id = 'jugador'>JUGADOR</div>
<div id = 'tablero'></div>
</body>
</html>
